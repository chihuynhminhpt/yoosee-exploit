#!/bin/sh

export MODULES_PATH=/ipc/modules
export WIFI_PATH=$MODULES_PATH/wifi
  
ifconfig eth0 up
insmod $MODULES_PATH/akgpios.ko

mmc_test -F &
echo -e "\e[1;32mstart mmc_test\e[0m"
sleep 1
#usb device
insmod $MODULES_PATH/otg-hs.ko

#usb device delay to get the right result of lsusb
sleep 2
lsusb

wifi_8188fu_vid_pid="0bda:f179"
wifi_9083h_vid_pid="2310:9086"
wifi_8811au_vid_pid="0bda:c811"
wifi_8731au_vid_pid="0bda:8731"
wifi_atbm603x_vid_pid="007a:8888"
wifi_rda5995_vid_pid="1e04:8888"
wifi_ssv6x5x_vid_pid="8065:6000"

usb_device_result_8188fu=`lsusb | grep $wifi_8188fu_vid_pid`
usb_device_result_9083h=`lsusb | grep $wifi_9083h_vid_pid`
usb_device_result_8811au=`lsusb | grep $wifi_8811au_vid_pid`
usb_device_result_8731au=`lsusb | grep $wifi_8731au_vid_pid`
usb_device_result_atbm603x=`lsusb | grep $wifi_atbm603x_vid_pid`
usb_device_result_rda5995=`lsusb | grep $wifi_rda5995_vid_pid`
usb_device_result_ssv6x5x=`lsusb | grep $wifi_ssv6x5x_vid_pid`

if [ "$usb_device_result_8188fu" != "" ]
then
    echo -e "\e[1;32mWifi type: 8188fu\e[0m"
    insmod $WIFI_PATH/8188fu.ko
elif [ "$usb_device_result_9083h" != "" ]
then
    echo -e "\e[1;32mWifi type: 9083h\e[0m"
    insmod $WIFI_PATH/9083h.ko
elif [ "$usb_device_result_8811au" != "" ]
then
    echo -e "\e[1;32mWifi type: 8731au\e[0m"
    insmod $WIFI_PATH/8731au.ko
elif [ "$usb_device_result_8731au" != "" ]
then
    echo -e "\e[1;32mWifi type: 8731au\e[0m"
    insmod $WIFI_PATH/8731au.ko
elif [ "$usb_device_result_atbm603x" != "" ]
then
    echo -e "\e[1;32mWifi type: atbm603x\e[0m"
    insmod $WIFI_PATH/atbm603x.ko
elif [ "$usb_device_result_rda5995" != "" ]
then
    echo -e "\e[1;32mWifi type: rda5995\e[0m"
    insmod $WIFI_PATH/rdawfmac.ko
elif [ "$usb_device_result_ssv6x5x" != "" ]
then
    echo -e "\e[1;32mWifi type: ssv6x5x\e[0m"
    insmod $WIFI_PATH/ssv6x5x.ko stacfgpath=$WIFI_PATH/ssv6x5x-wifi.cfg
else
    echo -e "\e[1;31mWifi type: unknown\e[0m"    
fi

ifconfig wlan0 up

#stop ipc
read -t 1 -p ">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>Input q enter:" getout
if [[ "$getout" == "q" ]];
then           
	echo ~~~~~~~~~~~~~~~~~~~~~~~~~~exit success~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	exit 0;
fi

IPC_EXE=/ipc/ipc

if [ -x ${IPC_EXE} ]; then
	${IPC_EXE} &
else
	echo "ERROR: \"${IPC_EXE}\" are NOT executable!"
fi
