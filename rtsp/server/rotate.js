const net = require("net");
const readline = require("readline");
const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout,
});

rl.on("close", function () {
  process.exit(0);
});

function ask() {
  return new Promise((cb) => {
    rl.question("> ", function (input) {
      let inputs = input.split(" ");
      let ip = inputs[0];
      let direction = inputs[1];

      let client = net.createConnection(554, ip, () => {
        if (direction == "UP") direction = "DWON";
        else if (direction == "DOWN") direction = "UP";
        else if (direction == "LEFT") direction = "RIGHT";
        else if (direction == "RIGHT") direction = "LEFT";

        client.write(`
          SET_PARAMETER rtsp://${ip}/onvif1 RTSP/1.0
          CSeq: 1
          Content-type: ptzCmd: ${direction}
        `);

        console.log("Packet sent");

        cb();

        client.end();
      });

      client.on("end", () => {
        console.log(`>>>>>>>>>>>> Disconnected from ${ip} <<<<<<<<<<<<<<<<<`);
        cb();
      });

      client.on("error", (err) => {
        console.log(err);
        client.destroy();
        cb();
      });
    });
  });
}

(async() => {
  while (true)
    await ask();
})();